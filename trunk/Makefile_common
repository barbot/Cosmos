
.PHONY: lib generator clean sim dir automataGen

all: dir lib generator

dir:
	mkdir -p bin
	mkdir -p includes
	mkdir -p Obj/Cosmos
	mkdir -p Obj/ModelGenerator/Eval
	mkdir -p Obj/ModelGenerator/GspnParser
	mkdir -p Obj/ModelGenerator/LhaParser

lib: includes/spn.hpp includes/LHA.hpp includes/marking.hpp
	@(cd SOURCES/Cosmos && $(MAKE) ../../bin/libClientSim.a)

includes/%.hpp: SOURCES/Cosmos/%.hpp
	cp SOURCES/Cosmos/$*.hpp $@

generator:
	@(cd SOURCES/ModelGenerator && $(MAKE) ../../bin/Cosmos)

cleanSim:
	@(cd SOURCES/Cosmos && $(MAKE) clean)
	
cleanGen:
	@(cd SOURCES/ModelGenerator && $(MAKE) clean)

clean:
	@(cd SOURCES/Cosmos && $(MAKE) $@)
	@(cd SOURCES/ModelGenerator && $(MAKE) $@)
	@(cd automataGen && ocamlbuild -clean)
	@(rm -rf package-alligator.zip)

cleansim:
	@(cd SOURCES/Cosmos && $(MAKE) clean)


parser:
	@(cd SOURCES/ModelGenerator && $(MAKE) parser)

cleanparser:
	@(cd SOURCES/ModelGenerator && $(MAKE) cleanparser)

automataGen:
	@(cd automataGen && ocamlbuild generator.native)
	cp automataGen/generator.native bin/automataGen

package: all
	mkdir package
	cp Readme.txt package/
	cp COPYING package/
	cp -r includes package/includes
	cp -r bin package/bin